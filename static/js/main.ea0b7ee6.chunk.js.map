{"version":3,"sources":["types.ts","store/actions.ts","color.ts","board.ts","store/index.ts","use-animate-grid.ts","use-previous.ts","use-rects.ts","components/GridSVG.tsx","components/Grid.tsx","components/Game.tsx","components/App.tsx","index.tsx"],"names":["Color","isActionReset","action","type","isActionStartGame","startGame","seed","Date","now","toString","data","isActionFlood","isActionUndoMove","COLOR_ARRAY","RED","ORANGE","YELLOW","GREEN","BLUE","PURPLE","getRandomColor","rng","Math","random","i","floor","color","getBoardWidth","board","length","getBoardHeight","getBoardColor","x","y","setBoardColor","buildBoard","width","height","row","push","randomiseBoard","isAllOneColor","target","flood","replacement","copy","copyBoard","queue","shift","DEFAULT_STATE","lastBoard","moves","isGameOver","isGameWon","currentColor","reducer","state","seedrandom","newBoard","newMoves","getSeed","getMoves","getBoard","canUndoLastMove","useAnimateGrid","gridRef","previousBoard","value","ref","React","current","usePrevious","rects","setRects","children","querySelectorAll","Array","from","useRects","boardWidth","boardHeight","maxDistance","sqrt","start","clock","requestAnimationFrame","loop","time","progress","t","rect","previousColor","distanceOffset","min","max","dataset","cancelAnimationFrame","GridSVG","size","onClick","WIDTH","HEIGHT","VIEWBOX","key","id","onTouchStart","viewBox","preserveAspectRatio","Grid","className","Game","dispatch","useDispatch","useSelector","gameOver","gameWon","enableUndo","handleClickUndo","e","preventDefault","handleClickReset","handleClickNewGame","handleClickColor","disabled","App","store","createStore","rootReducer","composeWithDevTools","applyMiddleware","thunk","render","document","getElementById"],"mappings":"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","file":"static/js/main.ea0b7ee6.chunk.js","sourcesContent":["export enum Color {\n  RED,\n  ORANGE,\n  YELLOW,\n  GREEN,\n  BLUE,\n  PURPLE,\n}\n\nexport type Board = Color[][]\n","import { Action } from 'redux';\nimport { Color } from '../types';\n\n/* Reset action */\n\nexport const ACTION_RESET = 'RESET';\n\nexport interface ActionReset extends Action<typeof ACTION_RESET> { }\n\nexport const isActionReset = (action: Action): action is ActionReset => (\n  action.type === ACTION_RESET\n);\n\nexport const reset = (): ActionReset => ({\n  type: ACTION_RESET,\n});\n\n/* Start game action */\n\nexport const ACTION_START_GAME = 'START_GAME';\n\nexport interface ActionStartGame extends Action<typeof ACTION_START_GAME> {\n  data: {\n    seed: string;\n  };\n}\n\nexport const isActionStartGame = (action: Action): action is ActionStartGame => (\n  action.type === ACTION_START_GAME\n);\n\nexport const startGame = (seed = Date.now().toString()): ActionStartGame => ({\n  type: ACTION_START_GAME,\n  data: {\n    seed,\n  },\n});\n\n/* Flood action */\n\nexport const ACTION_FLOOD = 'FLOOD';\n\nexport interface ActionFlood extends Action<typeof ACTION_FLOOD> {\n  data: {\n    color: Color;\n  };\n}\n\nexport const isActionFlood = (action: Action): action is ActionFlood => (\n  action.type === ACTION_FLOOD\n);\n\nexport const flood = (color: Color): ActionFlood => ({\n  type: ACTION_FLOOD,\n  data: {\n    color,\n  },\n});\n\n/* Undo move action */\n\nexport const ACTION_UNDO_MOVE = 'UNDO_MOVE';\n\nexport interface ActionUndoMove extends Action<typeof ACTION_UNDO_MOVE> { }\n\nexport const isActionUndoMove = (action: Action): action is ActionUndoMove => (\n  action.type === ACTION_UNDO_MOVE\n);\n\nexport const undoMove = (): ActionUndoMove => ({\n  type: ACTION_UNDO_MOVE,\n});\n","import { Color } from './types';\n\nexport const COLOR_COUNT = 6;\n\nexport const COLOR_ARRAY = [\n  Color.RED,\n  Color.ORANGE,\n  Color.YELLOW,\n  Color.GREEN,\n  Color.BLUE,\n  Color.PURPLE,\n];\n\nexport const getRandomColor = (rng = Math.random): Color => {\n  const i = Math.floor(rng() * COLOR_COUNT);\n  const color = COLOR_ARRAY[i];\n  return color;\n};\n","import { Board, Color } from './types';\nimport { getRandomColor } from './color';\n\nexport const getBoardWidth = (board: Board): number => board[0].length;\nexport const getBoardHeight = (board: Board): number => board.length;\nexport const getBoardColor = (board: Board, x: number, y: number): Color => board[y][x];\nexport const setBoardColor = (board: Board, x: number, y: number, color: Color): void => { board[y][x] = color; };\n\nexport const buildBoard = (width: number, height: number): Board => {\n  const board = [];\n  for (let y = 0; y < height; y++) {\n    const row = [];\n    for (let x = 0; x < width; x++) {\n      row.push(0);\n    }\n    board.push(row);\n  }\n  return board;\n};\n\nexport const copyBoard = (board: Board): Board => {\n  const copy: Board = [];\n  const height = getBoardHeight(board);\n  for (let y = 0; y < height; y++) {\n    copy.push([...board[y]]);\n  }\n  return copy;\n};\n\nexport const randomiseBoard = (board: Board, rng = Math.random): void => {\n  const width = getBoardWidth(board);\n  const height = getBoardHeight(board);\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const color = getRandomColor(rng);\n      setBoardColor(board, x, y, color);\n    }\n  }\n};\n\nexport const isAllOneColor = (board: Board): boolean => {\n  const width = getBoardWidth(board);\n  const height = getBoardHeight(board);\n  const target = getBoardColor(board, 0, 0);\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const color = getBoardColor(board, x, y);\n      if (color !== target) return false;\n    }\n  }\n  return true;\n};\n\n/**\n@see https://en.wikipedia.org/wiki/Flood_fill#Alternative_implementations\n\nFlood-fill (node, target-color, replacement-color):\n  1. If target-color is equal to replacement-color, return.\n  2. If color of node is not equal to target-color, return.\n  3. Set the color of node to replacement-color.\n  4. Set Q to the empty queue.\n  5. Add node to the end of Q.\n  6. While Q is not empty:\n  7.     Set n equal to the first element of Q.\n  8.     Remove first element from Q.\n  9.     If the color of the node to the west of n is target-color,\n             set the color of that node to replacement-color and add that node to the end of Q.\n 10.     If the color of the node to the east of n is target-color,\n             set the color of that node to replacement-color and add that node to the end of Q.\n 11.     If the color of the node to the north of n is target-color,\n             set the color of that node to replacement-color and add that node to the end of Q.\n 12.     If the color of the node to the south of n is target-color,\n             set the color of that node to replacement-color and add that node to the end of Q.\n 13. Continue looping until Q is exhausted.\n 14. Return.\n*/\nexport const flood = (board: Board, replacement: Color): Board => {\n  const copy = copyBoard(board);\n  const target = getBoardColor(board, 0, 0);\n  if (target === replacement) return copy;\n  const width = getBoardWidth(board);\n  const height = getBoardHeight(board);\n  const queue = [[0, 0]];\n  setBoardColor(copy, 0, 0, replacement);\n  while (queue.length) {\n    const [x, y] = queue.shift() as [number, number];\n    // East\n    if (x + 1 < width) {\n      const color = getBoardColor(copy, x + 1, y);\n      if (color === target) {\n        setBoardColor(copy, x + 1, y, replacement);\n        queue.push([x + 1, y]);\n      }\n    }\n    // South\n    if (y + 1 < height) {\n      const color = getBoardColor(copy, x, y + 1);\n      if (color === target) {\n        setBoardColor(copy, x, y + 1, replacement);\n        queue.push([x, y + 1]);\n      }\n    }\n    // West\n    if (x > 0) {\n      const color = getBoardColor(copy, x - 1, y);\n      if (color === target) {\n        setBoardColor(copy, x - 1, y, replacement);\n        queue.push([x - 1, y]);\n      }\n    }\n    // North\n    if (y > 0) {\n      const color = getBoardColor(copy, x, y - 1);\n      if (color === target) {\n        setBoardColor(copy, x, y - 1, replacement);\n        queue.push([x, y - 1]);\n      }\n    }\n  }\n  return copy;\n};\n","import { Reducer } from 'redux';\nimport seedrandom from 'seedrandom';\nimport { isActionReset, isActionStartGame, isActionFlood, isActionUndoMove } from './actions';\nimport { Board, Color } from '../types';\nimport { buildBoard, randomiseBoard, getBoardColor, flood, isAllOneColor } from '../board';\n\nexport interface RootReducerState {\n  seed: string;\n  board: Board | null;\n  lastBoard: Board | null;\n  moves: number;\n  isGameOver: boolean;\n  isGameWon: boolean;\n  currentColor: Color | null;\n}\n\nexport const DEFAULT_STATE: RootReducerState = {\n  seed: '',\n  lastBoard: null,\n  board: null,\n  moves: 0,\n  isGameOver: false,\n  isGameWon: false,\n  currentColor: null,\n};\n\nexport const reducer: Reducer<RootReducerState> = (state = DEFAULT_STATE, action) => {\n  if (isActionReset(action)) {\n    return DEFAULT_STATE;\n  }\n\n  if (isActionStartGame(action)) {\n    const { seed } = action.data;\n    const board = buildBoard(14, 14);\n    randomiseBoard(board, seedrandom(seed));\n    const currentColor = getBoardColor(board, 0, 0);\n    return {\n      seed,\n      board,\n      currentColor,\n      lastBoard: null,\n      moves: 0,\n      isGameOver: false,\n      isGameWon: false,\n    };\n  }\n\n  if (isActionFlood(action)) {\n    const { color } = action.data;\n    let { board, moves, isGameOver, isGameWon, currentColor } = state;\n    // Game must have started\n    if (!board) return state;\n    // Game cannot be over\n    if (isGameOver) return state;\n    // Must choose a new color\n    if (currentColor === color) return state;\n    const newBoard = flood(board, color);\n    const newMoves = moves + 1;\n    if (isAllOneColor(newBoard)) {\n      isGameOver = true;\n      isGameWon = true;\n      board = null;\n    } else if (newMoves >= 25) {\n      isGameOver = true;\n    }\n    return {\n      ...state,\n      lastBoard: board,\n      board: newBoard,\n      moves: newMoves,\n      currentColor: color,\n      isGameOver,\n      isGameWon,\n    };\n  }\n\n  if (isActionUndoMove(action)) {\n    const { lastBoard, moves } = state;\n    if (!lastBoard) return state;\n    return {\n      ...state,\n      lastBoard: null,\n      board: lastBoard,\n      moves: moves - 1,\n      currentColor: getBoardColor(lastBoard, 0, 0),\n    };\n  }\n\n  return state;\n};\n\nexport default reducer;\n\nexport const getSeed = (state: RootReducerState) => state.seed;\nexport const getMoves = (state: RootReducerState) => state.moves;\nexport const getBoard = (state: RootReducerState) => state.board;\nexport const isGameOver = (state: RootReducerState) => state.isGameOver;\nexport const isGameWon = (state: RootReducerState) => state.isGameWon;\nexport const getCurrentColor = (state: RootReducerState) => state.currentColor;\nexport const canUndoLastMove = (state: RootReducerState) => state.lastBoard !== null;\n","import * as React from 'react';\r\nimport { Board } from './types';\r\nimport { getBoardWidth, getBoardHeight, getBoardColor } from './board';\r\nimport { usePrevious } from './use-previous';\r\nimport { useRects } from './use-rects';\r\n\r\nconst PERIOD = 500;\r\nconst MAX_DISTANCE_OFFSET = 500;\r\n\r\nexport const useAnimateGrid = (board: Board, gridRef: React.RefObject<SVGSVGElement>) => {\r\n  const previousBoard = usePrevious(board);\r\n  const rects = useRects(gridRef);\r\n\r\n  React.useEffect(() => {\r\n    if (!rects.length) return;\r\n\r\n    const boardWidth = getBoardWidth(board);\r\n    const boardHeight = getBoardHeight(board);\r\n    const maxDistance = Math.sqrt(boardWidth ** 2 + boardHeight ** 2);\r\n    const length = boardWidth * boardHeight;\r\n\r\n    let start: number | null = null;\r\n\r\n    const loop = (time: number) => {\r\n      if (start === null) start = time;\r\n      /** Milliseconds since start */\r\n      const progress = time - start;\r\n      /** Between 0 and 1 */\r\n      let t = 0;\r\n\r\n      for (let i = 0; i < length; i++) {\r\n        const rect = rects[i];\r\n        const x = i % boardWidth;\r\n        const y = Math.floor(i / boardWidth);\r\n\r\n        // Color at these coords\r\n        const color = getBoardColor(board, x, y);\r\n\r\n        // First time painting, scenario 1\r\n        if (!previousBoard) {\r\n          rect.dataset.color = color.toString();\r\n          continue;\r\n        }\r\n\r\n        // Color at these coords on the last move\r\n        const previousColor = getBoardColor(previousBoard, x, y);\r\n\r\n        // First time painting, scenario 2\r\n        if (color === previousColor) {\r\n          rect.dataset.color = color.toString();\r\n          continue;\r\n        }\r\n\r\n        /** Between 0 and `maxDistance` */\r\n        const distance = Math.sqrt(x ** 2 + y ** 2);\r\n        /** Between 0 and 1 */\r\n        const distanceOffset = distance / maxDistance;\r\n        /** Between 0 and 1 */\r\n        t = Math.min(Math.max(progress - distanceOffset * MAX_DISTANCE_OFFSET, 0) / PERIOD, 1);\r\n\r\n        rect.dataset.color = (t > 0 ? color : previousColor).toString();\r\n      }\r\n\r\n      if (t < 1) clock = requestAnimationFrame(loop);\r\n    };\r\n\r\n    let clock = requestAnimationFrame(loop);\r\n\r\n    return () => cancelAnimationFrame(clock);\r\n  }, [rects, board, previousBoard]);\r\n};\r\n","import * as React from 'react';\r\n\r\nexport const usePrevious = <T>(value: T) => {\r\n\tconst ref = React.useRef<T>();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tref.current = value;\r\n\t}, [value]);\r\n\r\n\treturn ref.current;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport const useRects = (gridRef: React.RefObject<SVGSVGElement>) => {\r\n  const [rects, setRects] = React.useState<SVGRectElement[]>([]);\r\n\r\n  React.useEffect(() => {\r\n    if (!gridRef.current) return;\r\n    const parent = gridRef.current;\r\n    const children = parent.querySelectorAll('rect');\r\n    setRects(Array.from(children));\r\n  }, [gridRef]);\r\n\r\n  return rects;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport interface Props {\r\n  size?: number;\r\n  width: number;\r\n  height: number;\r\n  onClick: (x: number, y: number) => void;\r\n}\r\n\r\nconst GridSVG = React.forwardRef<SVGSVGElement, Props>(({ size = 35, width, height, onClick }, ref) => {\r\n  const WIDTH = width * size;\r\n  const HEIGHT = height * size;\r\n  const VIEWBOX = `0 0 ${WIDTH} ${HEIGHT}`;\r\n  const children: React.ReactChild[] = [];\r\n\r\n  for (let y = 0; y < height; y++) {\r\n    for (let x = 0; x < width; x++) {\r\n      children.push(\r\n        <rect\r\n          key={x + ',' + y}\r\n          id={x + ',' + y}\r\n          x={x * size - 0.5}\r\n          y={y * size - 0.5}\r\n          width={size + 1}\r\n          height={size + 1}\r\n          onClick={() => onClick(x, y)}\r\n          onTouchStart={() => onClick(x, y)}\r\n        />\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <svg\r\n      ref={ref}\r\n      width={WIDTH}\r\n      height={HEIGHT}\r\n      viewBox={VIEWBOX}\r\n      preserveAspectRatio=\"none\"\r\n    >\r\n      {children}\r\n    </svg>\r\n  );\r\n});\r\n\r\nexport default GridSVG;\r\n","import * as React from 'react';\nimport { Board, Color } from '../types';\nimport { getBoardWidth, getBoardHeight, getBoardColor } from '../board';\nimport { useAnimateGrid } from '../use-animate-grid';\nimport GridSVG from './GridSVG';\nimport './Grid.css';\n\nexport interface Props {\n  board: Board;\n  onClick: (color: Color) => void;\n}\n\nconst Grid: React.FC<Props> = ({ board, onClick }) => {\n  const gridRef = React.useRef<SVGSVGElement>(null);\n  const boardWidth = getBoardWidth(board);\n  const boardHeight = getBoardHeight(board);\n\n  useAnimateGrid(board, gridRef);\n\n  return (\n    <div className=\"Grid d-flex align-items-center\">\n      <GridSVG\n        ref={gridRef}\n        width={boardWidth}\n        height={boardHeight}\n        onClick={(x, y) => {\n          onClick(getBoardColor(board, x, y))\n        }}\n      />\n    </div>\n  );\n};\n\nexport default Grid;\n","import * as React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Color } from '../types';\nimport { getSeed, getBoard, getMoves, isGameOver, isGameWon, canUndoLastMove } from '../store';\nimport { startGame, flood, undoMove } from '../store/actions';\nimport Grid from './Grid';\nimport './Game.css';\n\nconst Game: React.FC = () => {\n  const dispatch = useDispatch();\n  const seed = useSelector(getSeed);\n  const board = useSelector(getBoard);\n  const moves = useSelector(getMoves);\n  const gameOver = useSelector(isGameOver);\n  const gameWon = useSelector(isGameWon);\n  const enableUndo = useSelector(canUndoLastMove);\n\n  const handleClickUndo = React.useCallback<React.MouseEventHandler>((e) => {\n    e.preventDefault();\n    dispatch(undoMove());\n  }, [dispatch]);\n\n  const handleClickReset = React.useCallback<React.MouseEventHandler>((e) => {\n    e.preventDefault();\n    dispatch(startGame(seed));\n  }, [dispatch, seed]);\n\n  const handleClickNewGame = React.useCallback<React.MouseEventHandler>((e) => {\n    e.preventDefault();\n    dispatch(startGame());\n  }, [dispatch]);\n\n  const handleClickColor = React.useCallback((color: Color) => {\n    dispatch(flood(color));\n  }, [dispatch]);\n\n  if (!board) return null;\n\n  return (\n    <div className=\"Game\">\n      <nav className=\"navbar navbar-light bg-light\">\n        <button\n          className=\"btn btn-dark mr-auto\"\n          type=\"button\"\n          onClick={handleClickNewGame}\n        >\n          New game\n        </button>\n        <button\n          className=\"btn btn-light ml-1\"\n          type=\"button\"\n          disabled={!enableUndo}\n          onClick={handleClickUndo}\n        >\n          Undo move\n        </button>\n        <button\n          className=\"btn btn-light ml-1\"\n          type=\"button\"\n          onClick={handleClickReset}\n        >\n          Restart\n        </button>\n      </nav>\n      <div className=\"mt-4 mb-4\">\n        <Grid\n          board={board}\n          onClick={handleClickColor}\n        />\n      </div>\n      <div className=\"d-flex flex-column align-items-center\">\n        <span className=\"display-4\">{moves} / 25</span>\n        {gameOver && <strong className=\"mr-3\">Game over</strong>}\n        {gameWon && <strong className=\"mr-3\">You win</strong>}\n      </div>\n    </div>\n  );\n};\n\nexport default Game;\n","import * as React from 'react';\nimport Game from './Game';\nimport './App.css';\n\nconst App: React.FC = () => (\n  <div className=\"App container pt-5 pb-5\">\n    <Game />\n\n    <div className=\"mt-5 text-center\">\n      <h2>How to play</h2>\n      <p>Tap colors to flood-fill the board from the top left corner. The goal is to make the whole board a single color within 25 moves.</p>\n    </div>\n  </div>\n);\n\nexport default App;\n","import * as React from 'react';\nimport { render } from 'react-dom';\nimport { createStore, applyMiddleware } from 'redux';\nimport rootReducer from './store';\nimport { composeWithDevTools } from 'redux-devtools-extension';\nimport thunk from 'redux-thunk';\nimport { Provider as StoreProvider } from 'react-redux';\nimport App from './components/App';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './styles.css';\nimport { startGame } from './store/actions';\n\nconst store = createStore(rootReducer, composeWithDevTools(\n  applyMiddleware(thunk),\n));\n\nstore.dispatch(startGame());\n\nrender(\n  <StoreProvider store={store}>\n    <App />\n  </StoreProvider>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}